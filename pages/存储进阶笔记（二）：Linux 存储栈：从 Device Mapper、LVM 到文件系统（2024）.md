- 来源：
	- https://arthurchiao.art/blog/storage-advanced-notes-2-zh/
- Tags: [[Computer Science]] [[存储]] [[Storage]] [[文件系统]] [[File System]]
-
- 1 Device Mapper：内核存储基础设施
	- 1.1 内核框架： `物理块设备 -> 虚拟块设备`
		- [Device mapper](https://en.wikipedia.org/wiki/Device_mapper)（**==设备映射器==**） 是 Linux 内核提供的一个框架，用于将**==物理块设备==**（physical block devices） 映射到更上层的**==虚拟块设备==**（virtual block devices）。
			- 是逻辑卷管理器（**==LVM==**）、**==software RAID==** 和 dm-crypt 磁盘加密技术的**==基础==**，
			- 还提供了诸如**==文件系统快照==**等功能，
			- 还可以在传递数据的同时进行修改，例如，在提供磁盘加密，或者模拟不可靠的硬件行为。
	- 1.2 在内核存储栈中的位置
		- ![](https://arthurchiao.art/assets/img/how-hdd-works/Linux-storage-stack-diagram_v6.9.png){:height 1027, :width 719}{:height 1027, :width 719}
	- 1.3 使用场景及典型应用
		- **==dm-cache==**：组合使用 SSD 和 HDD 的**==混合卷==**（hybrid volume）
			- A [hybrid volume](https://en.wikipedia.org/wiki/Logical_volume_management) is any volume that intentionally and opaquely makes use of two separate physical volumes. For instance, a workload may consist of random seeks so an SSD may be used to permanently store frequently used or recently written data, while using higher-capacity rotational magnetic media for long-term storage of rarely needed data. On Linux, **==bcache==** or **==dm-cache==** may be used for this purpose.
				- 混合卷指的是有意识且不透明地使用两个独立物理卷的任何卷。例如，对于包含随机读写的工作负载，可以使用 SSD 来永久存储经常使用或最近写入的数据，同时使用容量更大的机械硬盘来长期存储很少需要访问的数据。在 Linux 系统中，可以使用 bcache 或 dm-cache 来实现这个目的。
		- **==Docker==** – 基于 device mapper 给容器创建 **==copy-on-write==** 存储；
		- **==LVM2==** – 内核最常用的一种逻辑卷管理器（logical volume manager）
- 2 LVM：基于 Device Mapper 创建逻辑卷（设备）
	- 2.1 功能
		- [Logical Volume Manager](https://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)) （LVM，逻辑卷管理器）1998 年引入内核，是一个**==基于 device mapper 的框架==**， 为内核提供**==逻辑卷管理能力==**。
		- LVM 可以认为是物理磁盘和分区之上的一个**==很薄的软件层==**， 能方便换盘、重新分区和备份等等管理工作。
	- 2.2 LVM 中的概念/术语图解
		- ![](https://arthurchiao.art/assets/img/storage-advanced-notes/lvm-concepts.png){:height 565, :width 719}
		-
	- 2.3 使用场景
		- LVM 使用场景：
			- 将多个物理卷（physical volumes）或物理盘创建为一个逻辑卷（logical volume），**==有点类似于 RAID0，但更像 JBOD==**，好处是方便动态调整卷大小。
			- 热插拔，能在不停服的情况下添加或替换磁盘，管理非常方便。
	- 2.4 使用教程
		- [What is LVM2 in Linux?](https://medium.com/@The_Anshuman/what-is-lvm2-in-linux-3d28b479e250), medium.com, 2023
- 3 文件系统：基于物理或逻辑卷（块设备），创建和管理文件层级
	- 3.1 常规文件系统：不能跨 device
		-