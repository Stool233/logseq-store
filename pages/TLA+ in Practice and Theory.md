- https://pron.github.io/posts/tlaplus_part2
	- 在第一部分中，我们讨论了TLA+设计的动机、用途以及指导原则。现在，我们将转向研究这种语言的细节。我们将从用于描述计算的静态状态的语言元素开始，即程序的数据和数据操作，这些是计算的基本构建块。我们将这部分TLA+称为数据逻辑。
	- ## **使用数学描述数据和操作**
		- TLA+采用行动的时序逻辑（TLA），来描述计算作为一个离散动态系统，这与使用常微分方程描述连续系统类似。就像常微分方程定义在一个状态空间上，其中变量可以在实数R中取值一样。TLA公式的状态空间是某种逻辑结构（我们将准确了解这意味着什么），该结构包含了TLA变量在任何时间点可以取得的值。在TLA+中，集合构成了这种结构，而描述该结构中元素的逻辑理论基于一阶逻辑和策梅洛-弗兰克尔集合论（ZFC）——普通数学的标准形式。这意味着我们将使用形式数学来描述我们的软件，或者，就目前而言，仅描述它们的数据结构和基本操作。“形式”简单地意味着在一个系统（一个“形式系统”或一个“形式体系”）中工作，该系统具有精确的规则，包括句法规则——如何构建表达式，以及语义规则——表达式的含义。
		- TLA+的这个静态组成部分占据了TLA+语言的大部分，如果你对规格语言和证明助手不熟悉，理解它将教会你在计算机上进行形式数学的所有基本知识。但从理论角度看，这是TLA+中最不有趣且最不重要的部分（TLA，动态组成部分是有趣且必需的部分），尽管从设计和可用性的角度看它很重要，因为它被设计得尽可能简单和熟悉。然而，这也是TLA+中最有争议的方面。这是因为Lamport选择了一个无类型的数学形式主义，而大多数规格语言选择了一个有类型的形式主义。
		- 除了关于正确性或生产力等指标的有争议的声明（无论是辩论的哪一方）之外，大多数人都同意编程语言中的类型具有以下优势：它们帮助编译器（特别是AOT编译器）生成高效的机器代码，并通过提供某种形式的最新文档来帮助组织代码，鼓励对子程序进行合理的关注。它们还辅助工具进行自动完成和自动重构。然而，这些较不具争议的优势对于像TLA+这样的规格语言来说并不适用，因为它不会被编译成可执行文件，而且由于规格说明的长度比程序代码短得多，因此几乎不会从旨在帮助大型程序员团队维护大型代码库的功能中受益。因此，规格语言——或一般的数学——在类型化和无类型形式主义之间的权衡与编程语言的权衡不同，这一点在Lamport和Larry Paulson（证明助手Isabelle的作者）共同且平衡的论文中有很好的覆盖，论文题为《您的规格语言应该是类型化的吗？》
		- Lamport的选择是由他对TLA+预期受众的简单性愿望（正如他所看到的）推动的，即工程师，可能还因为他作为一名经典数学家的背景。集合论具有熟悉而强大的优势，Lamport表示，他确实相信在实践中对工程师来说使用集合论来规定系统更简单。
		- 其他规格语言可能需要类型系统，因为它们用途不仅仅是软件或硬件规格的定义。Lamport写道：
			- 没有充分的理由去写一个像 {1, {2,3}} 这样的集合，而且使其无法写出似乎是个好主意。然而，我发现没有简单的方法可以做到在不同时也使有用的集合无法写出的情况下，使这样的集合无法写出。这意味着，Coq 不简单……这并不意味着 Coq 有什么问题；它只是意味着它不适用于普通工程师。例如，如果你查看一本数学文本，你可能会发现在单一段落中“+”符号被用来表示几个不同的事物。要在 TLA+ 中形式化那个数学，你必须为那些不同的含义使用不同的符号。这会让数学家感到疯狂。Coq 允许你对所有这些使用相同的符号。因此，正如 George Gonthier 将告诉你的，你需要像 Coq 这样的东西来形式化严肃的数学。由于系统构建者和算法设计师不使用那种数学，他们不需要处理像 Coq 这样的语言的复杂性。
		- TLA+ 的静态组成部分是 Lamport 称之为 ZFM 的形式集合论，ZF 代表数学中的 ZF，他在这篇短文中解释了这一点（连同与类型化形式主义的比较）。
		- 逻辑学家可能会发现 TLA+ 的形式主义太普通；甚至可能觉得枯燥。数学家 G.H. Hardy 曾经写道：“‘真正的’数学家的‘真正的’数学……几乎完全是‘无用的’……是那些乏味且基础的部分……不管好坏，都是这些起作用。”但 TLA+ 不是一个用于探索数学秘密或新颖逻辑的工具，而是一个供工程师们用来指定“有效工作”的系统的工具。就普通数学而言，TLA+ 是一个清晰、简单且强大的形式主义，具有方便自然的语法。
		- TLA+ 使用形式数学来指定软件系统。正如你将看到的，它对程序员来说并不像一开始听起来那么可怕。编程是将非正式要求转化为软件的低级形式规格——程序。如果你能够做到这一点，如果你理解为什么你的程序可以工作，或者至少，它应该如何工作，你也可以编写一个高级的数学规格。这只需要一些练习。在《指定系统》的引言中，Lamport写道：
			- 我们使用的数学比你从小接触的数学更加形式化......大多数数学家和科学家编写的数学并不是真正精确的。它在小范围内精确，但在大范围内不精确。每个方程都是一个精确的声明，但你必须阅读伴随的文字才能理解方程之间是如何相关的，以及定理的确切含义是什么。逻辑学家已经开发出了消除这些文字并使数学完全形式化的方法，因此，完全精确......[M]数学家和科学家认为没有文字的形式数学是冗长且乏味的。他们错了。普通数学可以在一个精确的、完全形式化的语言中紧凑地表达。在 DifferentialEquations 模块中定义一个任意微分方程的解只需要大约二十几行......但是很少有规格需要如此复杂的数学。大多数只需要简单应用几个标准的数学概念。
		- 我必须再次提醒你，这不是一个教程，而且覆盖的许多材料并不是编写良好的 TLA+ 规格所必需的。虽然我会介绍基础知识，并希望这篇文章中的示例能让你体验到形式数学规格是什么，以及它与编程的相似之处，但我的重点是 TLA+ 背后的数学理论和设计原则。对于 TLA+ 的好的动手教程，请参考我在第一部分中提到的那些。
	- ## **什么是逻辑？**
		- TLA+ 使用逻辑来指定算法及其数据结构。对于那些数学逻辑可能有些生疏的人来说，这里是一个复习。
		- ### 逻辑基础
			- 形式逻辑、符号逻辑或数学逻辑是一种形式系统或形式主义。它是一种精确的语言，用于讨论事物，或者至少是易于精确的事物。像任何语言一样，它具有语法，可以被视为形成句子的语法规则，以及语义或含义——语言讨论的内容。但是，作为精确的语言，它具有精确的语法和精确的语义。语法定义了如何形成语言中合法（格式良好）表达式的规则，语义通过将这些表达式与精确定义的数学对象连接起来来定义这些表达式的含义。语义使我们能确切地知道语言中任何短语的含义，语法使我们能够以这样一种方式操纵短语，即我们确切地知道其对含义的影响。
			- 逻辑的语法由一些内置的连接词组成——通常是∧表示合取（“和”），∨表示析取（“或”），¬或有时∼表示否定（“不”），⇒或→表示蕴含（“如果-那么”），≡或⇔表示等价（当且仅当，或 iff），一组变量（x，y，...）——我们用来指代对象的名称——以及一个签名，它是一组具有特定元数（符号接受的参数数量）的符号，如 5（0元），=（2元），<（2元），*（2元）或 -（一元负号）。例如，表达式 x∗5<−y∧¬(x<5) 是我举例的逻辑中的一个合法表达式。逻辑还可以有量词，最常见的是全称量词∀（“对于所有”）和存在量词∃（“存在”）。量词通常绑定变量。例如，∀x…，意味着“对于所有这样的对象 x ...”，或∃x…，意味着“存在这样的对象 x ...”。
			- 一个格式良好的表达式称为术语（语言的术语），因此语法通常被认为是所有术语的集合——语言中所有可能的格式良好的表达式。公式是一个布尔值表达式，即一个要么为真要么为假的表达式。在公式中未绑定出现的变量称为自由变量。没有自由变量的公式称为句子或封闭公式。
			- 逻辑也有一个结构，这是逻辑的论域——逻辑所讨论的内容——它为签名提供意义或语义。为逻辑分配一个特定结构称为解释。像 2 这样的 0元符号的含义通常称为常数，而高元符号的含义通常称为关系（例如，小于关系，<）或函数。变量的含义也由结构定义，尽管这里逻辑的“阶”很重要。我们稍后会讨论这个主题，但在一阶逻辑中，变量可以指结构定义的可能值的集合中的任何值；该集合被称为逻辑的宇宙。
			- 模型是语法和语义之间的关系：公式的模型是满足它的结构，即使公式为真的变量值的分配（真实是一个语义属性）。表示“满足”的通常符号是⊨。左边是使右边的公式为真的结构——公式的模型。例如，我们逻辑的结构可以是具有乘法、否定和小于关系的整数集。那么表达式 x<2 的模型可以是 x=−5。所有使公式 A 为真的模型的集合形成其正式语义，通常写作 [[A]]。我将通俗地称这些模型的集合——公式的语义——为公式的模型，并说 x<2 的模型是任何将小于 2 的数字分配给 x 的赋值，或者更简单地说，所有小于 2 的数字。我们可以说这个公式指定了所有小于二的数字。在所有解释下为真的公式被称为有效的，我们写作 ⊨A（左边没有结构）。公式 TRUE 在所有解释下都被满足，而公式 FALSE 则根本没有模型。
			- 各种逻辑运算符以特定方式与模型交互。对于 A∧B ，其模型是 A 的模型与 B 的模型的交集，即 [[A∧B]] = [[A]] ∩ [[B]]。对于 A∨B ，其模型是 A 的模型与 B 的模型的并集，即 [[A∨B]] = [[A]] ∪ [[B]]。对于 ¬A ，其模型是 A 的模型的补集，即 [[¬A]] = [[A]]^c。这些正是我们在维恩图中熟悉的逻辑运算符的定义。
			- 当我们使用逻辑时，我们通常在特定的逻辑理论中工作，该逻辑理论是一组被认为等同于 TRUE 的公式集，称为公理。一个理论的模型是满足该理论所有公理的结构；换句话说，理论描述或规定了一个模型。因此，逻辑通常不是用结构来定义的，而是用理论来定义的，这个理论随后描述了所有合适的结构。例如，皮亚诺公理就是描述自然数及其熟知的算术运算的逻辑理论。我们熟知的自然数及其算术运算，就是皮亚诺算术的一个模型。
			- 当然，一个逻辑公式，甚至整个逻辑理论，在不同的结构上可以有多种解释。例如，公式 x>2 在实数上的模型与在自然数上的模型不同。句子 ∃x.x>0∧∀y.y>0⇒y≥x 在整数上解释为真，但在实数上解释为假。
			- 逻辑通常还有一个演算系统，这是一个从其他表达式推导表达式的句法系统，如自然演绎。如果公式 C 可以通过从公式 A 和 B 应用有限次推理规则得出，我们写作 A, B⊢C，并说 A 和 B 证明了 C 或蕴含了 C，其中 A 和 B 是假设，C 是它们的结果。可证明性是语义真理概念的句法对应物。如果一个公式 A 仅由理论的公理蕴含，没有其他假设，我们写作 ⊢A，并说 A 是一个重言式。如果 ⊢A 而 A 不是一个公理，我们说 A 是一个定理。如果我们想证明定理 A 但还没有做到，我们称 A 为一个命题。
			- 根据大多数逻辑的公理，如果 A, B⊢C，那么 ⊢(A∧B)⇒C，反之亦然。即，A 和 B 蕴含或证明 C 当且仅当 A∧B 蕴含 C。
			- 有两个重要的公理塑造了逻辑的一般性质。第一个称为爆炸原理，它声明对于任何公式 A，⊢¬(A∧¬A)，或等价地 A⊢¬¬A。第二个称为排中律，它声明对于任何公式 A，⊢A∨¬A，或等价地，¬¬A⊢A。拥有这两个公理的逻辑称为经典逻辑或标准逻辑。具有爆炸原理但没有排中律的逻辑称为直觉逻辑或构造逻辑（在此逻辑中，如果 A 被知道不是假的，我们不能得出它必须是真的）。具有排中律但没有爆炸原理的逻辑称为悖论逻辑（在此逻辑中，如果 A 是真的，我们不能得出它可能也不是假的）。构造逻辑和悖论逻辑都有有趣且有用的应用。如果没有这两个公理，我们就没有办法关联否定和肯定的陈述，这相当于根本没有否定的逻辑。TLA+ 中使用的所有逻辑都是经典的。
			- 请注意，在经典逻辑中（但非经典逻辑中不是这样！），存在量词和全称量词可以通过彼此来定义：
				- ∃x.A ≡ ¬∀x.¬A
				  ∀x.A ≡ ¬∃x.¬A
				- 简而言之，我们说 ∃ ≡ ¬∀¬ 和 ∀ ≡ ¬∃¬。
			- 逻辑，就像所有语言一样，表达意义。但是逻辑陈述的意义并不总是完全通过其形式语义来捕捉。逻辑学家戈特洛布·弗雷格指出，逻辑陈述可能具有两种意义：意义和指称（后者有时也称为外延）。例如，句子 3>2 的语义值为 TRUE，因此指向值 TRUE。句子 2>1 也指向值 TRUE，因此与 3>2 等价。然而，这两个句子具有不同的意义，因为它们表达了不同的想法（一个关于 3 和 2 的关系，另一个关于 2 和 1）。意义和指称之间的区别是全面理解所有逻辑（实际上是所有语言）所需的关键哲学观察，并且某些非经典逻辑 — 特别是直觉逻辑 — 可以明确地指涉这两种意义（使用不同的等价概念，一种称为外延的，是关于指称/外延的等价，另一种称为内涵的，可以被视为关于意义的等价）。但我们只处理经典逻辑，所以这一重要的哲学观点没有实际意义。
		- ### 一阶逻辑与其他阶逻辑
			- 一阶逻辑（或称为 FOL）包含所有常规的逻辑连接词（∧, ¬ 等），以及全称量词 ∀ 和存在量词 ∃。在 FOL 中，变量可以代表宇宙中的简单值：如果宇宙是自然数，则变量——无论是自由的还是量化的，即绑定的——代表一个自然数。如果我们想要量化更丰富的结构，如自然数的集合、自然数的函数等，我们需要通过扩展我们的理论将它们加入到宇宙中。
			- 在二阶逻辑（或称为 SOL）中，一个变量可以代表宇宙中的一个元素或一组元素。将这组元素视为一个谓词比较容易；一个谓词 p(x) 为真当且仅当值 x 在集合 p 中。因此，虽然在 FOL 中所有的谓词必须是“常量”并在签名中给出，在 SOL 中我们可以量化它们，并且可以说，例如，∀1x.∃2p.∀1y.p(y)≡(y=x)（符号 ≡ 代表双向蕴含，即当且仅当，我使用下标来区分一阶和二阶量化；通常这种区分从上下文中就能明确），或用话语表达为，“对于任何 x，存在一个谓词 p，对于参数 y 为真当且仅当 y=x”。
			- 类似地，三阶逻辑允许我们量化值的集合的集合等。高阶逻辑，或称为 HOL，允许我们量化任何阶的变量，通常只在类型化的形式主义中使用。类型的最初概念是由伯特兰·罗素准确地创造出来以区分阶次：不同阶次的对象属于不同的类型，即，如果我们的“基础”值属于第一类型，则这些值的集合属于第二类型，集合的集合属于第三类型等。类型在语法上和语义上都具有重要意义：如果 x 和 y 属于不同的类型，那么表达式 x=y 不是假的，而是格式不正确的，意味着它根本不是一个合法的表达式。类似于我上面使用的下标，HOL 中的量词通过类型来区分；我们写 ∃x:T（而不是 ∃Tx），意味着“存在一个类型为 T 的 x”。
			-
		-