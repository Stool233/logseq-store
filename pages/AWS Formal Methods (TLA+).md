- **TAG:** [[TLA+]]
- 这篇关于AWS形式化方法的实践（TLA+的实践）的文章的整理
	- https://lamport.azurewebsites.net/tla/formal-methods-amazon.pdf
- 文章摘要大纲（以及遇到的问题简述）
	- 从2011年开始，AWS使用形式化描述和模型检查（formal specification and model checking），去解决核心系统的复杂设计问题。
	- AWS在向客户提供上手简单的使用接口的背后，是一系列复杂的分布式系统在提供基础支撑。
		- 这些复杂的分布式系统有严苛的高可用与性能诉求，以及无情的业务增长带来的性能扩展性问题。
		- 为了达成这样的前所未有的目标，简单复用学术界/业界已经证明可靠的分布式算法（容错、一致性等类型），难以完成挑战，有时不得已需要修改这些算法，甚至发明自己的新的分布式算法。
			- 分布式算法难以避免的复杂度 增大了 人为的设计失误、代码编写失误、运维失误 出现的可能性
				- 这会导致严重的数据丢失或损坏，或违反我们的客户所依赖的其他接口契约（SLA）
			- 所以需要有手段保证核心系统的极度的可靠性。
				- 我们发现工业上的标准验证技术是必要的，但不是充分的。
					- 我们经常使用深度设计评审、代码评审、静态代码分析、压力测试和故障注入测试，但仍然发现在复杂的并发容错系统中隐藏着微妙的bug。
					- 一个原因是，在每秒数百万次请求规模的系统中，在估计所谓“极其罕见”的事件组合的真实概率方面，人类的直觉表现很差。
- 关键的见解（key insights）
	- 形式化方法在系统设计中找到我们所知道的其他技术无法找到的bug。
	- 形式化方法对于主流软件开发来说是出人意料的可行的，并且具备可观的投入产出比。
	- 在亚马逊，形式化方法通常被用于设计复杂的现实世界软件，包括公共云服务。
- 关于形式化方法（[[Formal Methods]]）的一些概述，以及AWS在实践上的整体感受
	- 人的不可靠性意味着一些更微妙、更危险的bug被证明是设计中的错误
		- 代码忠实地实现了预期的设计，但设计未能正确地处理特定的“罕见”场景
		- 我们发现，测试代码作为发现设计中细微错误的方法是不充分的，因为代码的可达状态的数量是天文数字。
			- 所以我们寻找更好的方法。
	- 更精确的设计（Precise Design）
		- 精确设计（precise design）的两个主要的好处
			- 作者被迫更清晰的思考，帮助消除“似是而非”的描述
			- 并且可以使用工具来检查设计中的错误，即使是还在写设计的过程中。
		- 与此相反，传统的设计文档 由 散文式的描述、静态的架构图、和不可测试的伪代码编写组成。
			- 这每一种都离“精确”很远，它们通常是不明确的，或缺少一些关键的描述(例如部分故障或并发粒度下的表现)。
			- 另一方面，最终的可执行代码是明确的，但包含大量的细节。我们必须在大量的代码中捕捉到设计的精髓。
		- 由于AWS的设计不可避免的复杂，我们需要找到一种表达力非常强的语言
			- 这种语言应该是高于代码层面
			- 但同时具备精确的语义
			- 同时这种表达力必须包含现实世界的并发和容错
		- 同时又希望它是高投资回报的现成方法
			- 由于希望快速地构建服务，我们需要一种易于学习和应用的语言，避免深奥的概念。
			- 我们也非常想要一个现有的工具生态系统。
		- 我们找到了TLA+
			- 一种形式化规范语言
				- 基于简单离散数学、基本集合理论、谓词
					- 工程师比较熟悉的概念
			- TLA+规范描述了一个系统的所有可能的合法行为或执行轨迹。
				- 我们发现用同样的语言来描述期望的系统的正确性特性(“什么”)和系统的设计(“如何”)是很有帮助的。
				- 在TLA+中，正确性属性和系统设计只是抽象阶梯上的一个台阶，其中正确性属性占据较高的层次，系统设计和算法位于中间，可执行代码和硬件位于较低的层次。
				- TLA+的目标是，通过传统的数学推理或TLC模型检查器等工具，尽可能简单地显示系统设计正确地实现了所需的正确性属性
					- TLC模型检查器采用TLA+规范，并在所有可能的执行轨迹上彻底检查所需的正确性属性。
				- 抽象的阶梯也帮助设计师管理现实世界系统的复杂性;
					- 设计人员可以选择在几个抽象的“中间”级别描述系统，每一个较低的级别服务于不同的目的(例如理解细粒度并发的结果或通信介质的更详细的行为)。
					- 然后设计师可以验证每个关卡相对于更高的关卡是否正确。
					- 选择和调整抽象级别的自由使得TLA+非常灵活。
			- 虽然TLA+的语法和习惯用法对程序员来说有些陌生，幸运的是，TLA+还附带了第二种名为PlusCal的语言，它更接近c风格的编程语言，但表现力更强，因为它使用TLA+来表示表达式和值。
				- PlusCal旨在直接替代伪代码。
				- 亚马逊的几位工程师发现，他们使用PlusCal比使用我们的TLA+更有效率。
					- 然而，在其他情况下，普通TLA+的额外灵活性非常有用。
					- 为了编写丰富的表达式，PlusCal用户必须熟悉TLA+，因为阅读TLA+翻译通常有助于理解一段代码的精确语义。
					- 此外，工具(如TLC模型检查器)工作在TLA+级别。
	- 将形式化方法运用于工业界（Formal Methods for Real-World Systems）
		-
	- 一个方面的好处
		- todo
	- 另一个方面的好处
		- todo
	- 在AWS的实践中，形式化方法不适用于什么场景
		- todo
- 形式化方法的实践在AWS的发展历程
	- 形式化方法实践走出的第一步（First Steps to Formal Methods）
		- todo
	- 第一个巨大的成功案例
		- todo
	- 如何推广给更多的工程师
		- todo
	- 工程师最常问的问题（我如何保证我的代码能正确实现 形式化验证的设计）
		- todo
- TLA+的其他替代选择
	- todo
- 业界其他相关的工作
	- todo
- 结论
	- todo